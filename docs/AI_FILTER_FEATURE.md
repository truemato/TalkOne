# AI Filter Feature (アメニティ機能)

## 概要
TalkOneのビデオ通話にAIフィルター機能を実装しました。この機能は高評価ユーザー（レーティング4.0以上）のみが利用できるアメニティ機能です。

## 機能詳細
- **素顔を隠す**: ユーザーの顔を完全に隠し、プライバシーを保護
- **カラフルエッジ検出**: 顔のパーツ（眉、目、鼻、口など）をカラフルな線画として表示
- **黒背景**: 背景を黒にして、顔のパーツのみが浮き上がる効果

## 技術実装

### Android側（Java）
1. **AIFilterService.java**: OpenCVを使用したエッジ検出とカラフル化処理
   - Cannyエッジ検出アルゴリズム
   - HoughLines変換による線検出
   - 角度に基づくHSVカラーマッピング

2. **AgoraVideoFrameProcessor.java**: Agoraのビデオフレームを処理
   - IVideoFrameObserverを実装
   - リアルタイムビデオフレーム処理

3. **MainActivity.kt**: Flutter-Android間の通信
   - MethodChannelによるAPI提供

### Flutter側
1. **ai_filter_service.dart**: AIフィルターのFlutterサービス
   - フィルターの有効/無効切り替え
   - パラメータ調整
   - アクセス権限チェック

2. **video_call_screen.dart**: UI統合
   - AIフィルターボタン（紫色で表示）
   - 長押しで設定画面表示
   - レーティングによるアクセス制御

## 使用方法
1. レーティング4.0以上のユーザーのみ、ビデオ通話画面にAIフィルターボタンが表示されます
2. ボタンをタップしてフィルターのオン/オフを切り替え
3. ボタンを長押しして詳細設定を開く：
   - エッジ検出感度（50-200）
   - エッジ検出強度（100-300）
   - カラフルエフェクトのオン/オフ

## パラメータ説明
- **threshold1（エッジ検出感度）**: 低い値ほど多くのエッジを検出
- **threshold2（エッジ検出強度）**: 高い値ほど強いエッジのみを検出
- **colorful**: オンの場合、線の角度に基づいてカラフルに表示

## 今後の拡張案
- 複数のフィルタースタイル追加
- AIによる顔認識精度向上
- リアルタイムパフォーマンス最適化
- より詳細なカスタマイズオプション